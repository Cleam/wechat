;Vue.component('vue-adsense',{template:'<ins class="adsbygoogle" :style="style" :data-ad-client="dataAdClient" :data-ad-slot="dataAdSlot"></ins>',props:['dataAdClient','dataAdSlot','style'],mounted:function(){(adsbygoogle=window.adsbygoogle||[]).push({});}});Vue.component('vue-image-adsense',{props:['dataLandingUrl','dataImgUrl'],template:'<a href="landingUrl">czxczxczxcxzc</a>'})
Vue.component('vue-dfp',{template:'<div :id="dfpId"></div>',props:['dfpId','slotId','width','height'],mounted:function(){var vue_this=this;googletag.cmd.push(function(){googletag.defineSlot(vue_this.slotId,[Math.floor(vue_this.width),Math.floor(vue_this.height)],vue_this.dfpId).addService(googletag.pubads());googletag.enableServices();googletag.display(vue_this.dfpId);});}});Vue.component('suggest-list',{delimiters:['[[',']]'],template:'<a class="quiz-item" :href="quizUrl"> <div class="img"><img :src="quizImage"></div> <div class="desc"> <div class="desc-content-wrapper"><div class="desc-content">[[quizTitle]]</div></div></div></a>',props:['quizId','quizImage','quizTitle','quizUrl'],computed:{quizHref:function(){return'/quiz/'+this.quizId;}}});Vue.component('vue-sketchpad',{delimiters:['[[',']]'],template:'<canvas id="sketchpad" width="300px" height="300px"></canvas>',props:['width','height','background'],data:{},computed:{},methods:{},mounted:function(){var sketcher=atrament('#sketchpad',300,300,'black');sketcher.weight=10;var ctx=this.$el.getContext("2d");var img=new Image();img.onload=function(){ctx.drawImage(img,0,0,ctx.canvas.width,ctx.canvas.height);};img.crossOrigin="Anonymous";img.src=this.background;}});Vue.component('vue-snsshare',{delimiters:['[[',']]'],template:'<div class="main main-col2" :class="name"><a href="#" :class="aclass"><button type="button" :class="bclass">[[text]]</button></a></div>',props:['name','bclass','index'],computed:{aclass:function(){return'icon-'+this.name;},bclass:function(){if(this.index==0){return}else{return'icon-only'}},text:function(){if(this.index==0){return'分享'}else{return}}},mounted:function(){}});;(function(document,Vue){'use strict';Vue.use(VueI18n);document.addEventListener("DOMContentLoaded",function(event){var question_app=new Vue({i18n:i18n,delimiters:['[[',']]'],el:'#question-app',data:{quiz_id:0,switch_ad_time:0,last_refresh_timestamps:0,qindex:0,qlist:[],quiz_list:[],calculating:false,user_choice_list:{},fr_token:"",insert_name:undefined,quiz_loaded:false,show_loading:false,show_upload_next_button:false,image_url:'/static/images/avater_upload.png',choice_sns_friends:[],notFriendsResultOrCanCalculateFriendResult:false,special_info:{},first_name:'',showAlbums:false,needFbPhotos:null,fbAlbumsPhotos:[]},computed:{qlength:function(){return this.qlist.length;},qccssclass:function(){switch(this.question.type){case 0:return'type-image';case 1:return'type-text';case 2:return'type-upload-image';case 3:return'type-input';}},qtype:function(){if(this.qlist[this.qindex]){if(this.qlist[this.qindex].type==2&&'undefined'!=typeof FB&&this.needFbPhotos!=false){this.showAlbums=true
this.getFbAlbums()}
return this.qlist[this.qindex].type;}
return 0;},question:function(){if(!this.qlist[this.qindex]){return;}
return this.qlist[this.qindex];},choice_pair:function(){if(this.question.choice){var qclist=[];var clist=[];for(var i=0;i<this.question.choice.length;i++){clist.push(this.question.choice[i]);if(clist.length===2){qclist.push(clist);clist=[];}}
return qclist;}}},methods:{fileobj_change:function(e){var vue_this=this;var file=e.target.files[0];console.log(file)
vue_this.show_loading=true;var orientation=0;EXIF.getData(file,function(){EXIF.getAllTags(this);orientation=EXIF.getTag(this,'Orientation');});var reader=new FileReader();reader.onload=function(readerEvent){var face_image=new Image();vue_this.show_upload_next_button=true
face_image.onload=function(imageEvent){var canvas=document.getElementById('sketchpad');drawPhotoImage(this,canvas,face_image,orientation);vue_this.image_url=canvas.toDataURL('image/jpeg');vue_this.show_loading=false;};face_image.src=readerEvent.target.result;};reader.readAsDataURL(file);},fbImgChoose:function(photoUrl){var vue_this=this;vue_this.image_url=photoUrl
vue_this.qsubmit_upload()},resetPhoto:function(){var vue_this=this;vue_this.show_upload_next_button=false;vue_this.image_url='/static/images/avater_upload.png'},switch_ad_tigger:function(){if(this.switch_ad_time!=0){if(Date.now()-this.last_refresh_timestamps>this.switch_ad_time){googletag.pubads().refresh();this.last_refresh_timestamps=Date.now();}}},calculate:function(){var vue_this=this;vue_this.calculating=true;if(vue_this.showAlbums==false&&vue_this.needFbPhotos!=false){var local=localStorage;var userInfo=eval('('+local.userInfo+')')
this.user_choice_list['anonymous']={url:userInfo.head}}
console.log(this.user_choice_list)
var startAnswerQuestDate=new Date()
this.$http.post("/api/quiz/answer",{'quiz_id':vue_this.quiz_id,'user_choice_list':JSON.stringify(this.user_choice_list),'user_id':localStorage.getItem('unique_user_id'),'csrfmiddlewaretoken':getCookie('csrftoken'),'fr_token':vue_this.fr_token},{emulateJSON:true}).then(function(response){var result=response.body;var result_wait_time=parseInt(result['result_wait'])*1000
var endAnswerQuestDate=new Date()
if(endAnswerQuestDate-startAnswerQuestDate>result_wait_time){result_wait_time=0}else{result_wait_time=result_wait_time-(endAnswerQuestDate-startAnswerQuestDate)}
var result_hashed_ids=result['hashed_ids'];var result_fr_token=result['fr_token'];var user_upload_img_url=result['user_upload_img_url'];setCookie('user_upload_image_url',user_upload_img_url,1);incr_taker_stat(vue_this.quiz_id,result.answer_id,'',get_sns_type(),'');localStorage.setItem('unique_user_id',result.user_id);if(result_hashed_ids&&result_fr_token){setTimeout(function(){var forwardUrl="";if(!vue_this.fr_token){forwardUrl='/f/'+result_hashed_ids+"/r/"+result_fr_token;}else{forwardUrl='/f/'+result_hashed_ids+"/ru/"+vue_this.fr_token+"/k/"+result_fr_token;}
if(!localStorage.result_list){localStorage.result_list=''}
localStorage.result_list+=(forwardUrl+',')
if($("#region").val()=="global"&&localStorage.faceBookShareMark==1){localStorage.faceBookShareMark=0;fbPublishAction("",window.location.origin+forwardUrl+"?utm_source=fb_as")}else{window.location.href=forwardUrl;}},result_wait_time);}else{window.location.href='/f/'+vue_this.quiz_id;}});},qsubmit_upload:function(event){window.scrollTo(0,0);var vue_this=this;if(this.question.type===2&&vue_this.image_url.indexOf("data:image/jpeg;base64")===-1){vue_this.user_choice_list[vue_this.question.id]={"url":vue_this.image_url};vue_this.qindex=vue_this.qindex+1;if(vue_this.qindex>=vue_this.qlength){vue_this.calculate();}
return;}
var canvas=document.getElementById('sketchpad');var previewUri=canvas.toDataURL('image/png');if(previewUri){vue_this.user_choice_list[vue_this.question.id]={"url":previewUri};}
vue_this.qindex=vue_this.qindex+1;while(vue_this.question&&(vue_this.question['jump_question']==='Y'||vue_this.question['type']===5)){vue_this.qindex=vue_this.qindex+1;}
if(!vue_this.question){vue_this.calculate();}},btnMousedown:function(event){event.target.style.opacity=0.6},btnMouseup:function(event){event.target.style.opacity=1},qsubmit:function(event,choice){window.scrollTo(0,0);this.switch_ad_tigger();if(this.question.type===0||this.question.type===1){if(choice&&choice["id"]){this.user_choice_list[this.question.id]={"id":choice.id};}}else if(this.question.type===3){if(this.insert_name){this.user_choice_list[this.question.id]={"text":this.insert_name};this.insert_name=''}else{alert('请输入文字！');return;}}
event.target.style.opacity=1
if(choice&&choice["jump_question_id"]!==0){var jump_question_id=choice["jump_question_id"];for(var i=0;i<this.qlist.length;i++){var jump_question=this.qlist[i];if(jump_question['id']===jump_question_id){this.qindex=i;break;}}}else{this.qindex=this.qindex+1;while(this.question&&(this.question['jump_question']==='Y'||this.question['type']===5)){this.qindex=this.qindex+1;}}
if(!this.question){this.calculate();}},load_quiz:function(){window.scrollTo(0,0);var vue_this=this;this.$http.post("/api/quiz/question/list",{'quiz_id':vue_this.quiz_id,'fr_token':vue_this.fr_token,'csrfmiddlewaretoken':getCookie('csrftoken')},{emulateJSON:true}).then(function(response){console.log(response.body.qlist)
vue_this.qlist=response.body.qlist;if(vue_this.qlist.length==1&&vue_this.qlist[0].type==5){vue_this.calculating=true;if(vue_this.notFriendsResultOrCanCalculateFriendResult==false){vue_this.notFriendsResultOrCanCalculateFriendResult=true;}else{vue_this.getChoiceFriends();}}
vue_this.quiz_loaded=true;});},getFbAlbums:function(){var vue_this=this;FB.api('/me/albums?locale=en_US&access_token='+localStorage.accessToken,'get',{limit:100,pretty:0,sdk:'joey',fields:'id,type,cover_photo,count,name'},function(response){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
if(response.data&&response.data.length){var item;var albumsIdList=[]
for(var i=0;i<response.data.length;i++){var album=response.data[i]
if(album.type=='profile'){albumsIdList.push(album.id)}}}
console.log(albumsIdList)
if(albumsIdList&&albumsIdList.length){vue_this.getFbAlbumsPhtotsData(albumsIdList)}})},getFbAlbumsPhtotsData:function(albumsIdList){var vue_this=this
for(var xx=0;xx<albumsIdList.length;xx++){var albumsId=albumsIdList[xx]
FB.api('/'+albumsId+'/photos?locale=en_US&access_token='+localStorage.accessToken,'get',{limit:100,pretty:0,sdk:'joey',fields:'id,created_time,comments.summary(true){from},likes.summary(true){total_count},source,picture,images'},function(response){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
if(response.data&&response.data.length){console.log(response.data)
for(var xxx=0;xxx<response.data.length;xxx++){var data=response.data[xxx]
var endPicture=''
for(var x=0;x<data.images.length;x++){var i=data.images[x]
endPicture=i.source
if(i.height<400){break}}
vue_this.fbAlbumsPhotos.push(endPicture)}}})}},load_suggestion_list:function(){var vue_this=this;this.$http.post("/api/suggest/quiz/list",{'csrfmiddlewaretoken':getCookie('csrftoken'),'quiz_id':this.quiz_id,'length':3},{emulateJSON:true}).then(function(response){vue_this.quiz_list=response.body;});},init_share:function(){var vue_this=this;var qrcode_popup=document.getElementById('qrcode-popup');var close_popup=document.getElementById('popup_close');close_popup.onclick=function(){qrcode_popup.style.display='';};this.$http.post("/api/quiz/info",{'csrfmiddlewaretoken':getCookie('csrftoken'),'quiz_id':vue_this.quiz_id},{emulateJSON:true}).then(function(response){vue_this.load_quiz();if(response.body.sns==''){vue_this.needFbPhotos=false}else if(response.body.sns=='facebook'&&JSON.stringify(response.body.special_info)=='{}'){var special_logicList=['face_swap','face_blend','face_swap_mult','face_blend_mult','face_rev_swap','face_rev_swap_mult','face_vlend','face_vlend_mult','draw_guess','face_blend_morphing','face_blend_gif','face_vlend_gif_in_frame']
if(response.body.special_logic&&special_logicList.indexOf(response.body.special_logic)!=-1){vue_this.needFbPhotos=true
var local=localStorage
var userInfo=eval('('+local.userInfo+')')
if(userInfo){vue_this.user_choice_list['user_profile']={birthday:userInfo.birthday||'',fb_id:userInfo.id||'',first_name:userInfo.first_name||'',full_name:userInfo.name||'',gender:userInfo.gender?userInfo.gender.substring(0,1).toUpperCase():'',id:userInfo.id||'',last_name:userInfo.last_name||'',name:userInfo.first_name||'',profile_image_url:"https://graph.facebook.com/"+userInfo.id+"/picture?type=large"}}}else{vue_this.needFbPhotos=false}}else if(JSON.stringify(response.body.special_info)!='{}'){vue_this.special_info=response.body.special_info;var time=0;var interval=setInterval(function(){if(typeof FB!='undefined'){clearInterval(interval)
vue_this.getSnsFriends();}
time+=300;if(time>5000){clearInterval(interval)}},300)}else{vue_this.notFriendsResultOrCanCalculateFriendResult=true;}
var runningSnsType=get_sns_type();if(runningSnsType==='wechat'){init_wx_share(response.body,function(){incr_question_share_stat(vue_this.quiz_id,0,'wechat','',vue_this.question.id);if(qrcode_popup){qrcode_popup.style.display='block';}});}});},getSnsFriends:function(){var vue_this=this;var fields=[];var nowDate=new Date();var nowYear=nowDate.getFullYear();var flag=false;var friendsData=[];var familyData=[];if(vue_this.special_info.family!='no'){FB.api('/me/family?locale=en_US&access_token='+localStorage.accessToken,'get',{limit:1000,fields:'gender, last_name, birthday, first_name, name, id'},function(response){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
familyData=response.data||[]
if(!flag){flag=true}else{vue_this.filterFriends(friendsData,familyData)}})}else{flag=true}
FB.api('/me/friends?locale=en_US&access_token='+localStorage.accessToken,'get',{limit:1000,fields:'gender, last_name, birthday, first_name, name, id'},function(response){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
friendsData=response.data||[];if(!flag){flag=true}else{vue_this.filterFriends(friendsData,familyData)}})},calculateFriendsScore:function(friendsData){var vue_this=this;var score_sns_friends=[];var local=localStorage;var userInfo=eval('('+local.userInfo+')')
var targetScore=4;if(!friendsData){friendsData=[]}
for(var x=0;x<friendsData.length;x++){var i=friendsData[x]
i.score=0;if(!vue_this.special_info.gender||vue_this.special_info.gender=='all'||!userInfo.gender){i.score=i.score+2;}else if(!i.gender){for(var j=0;j<vue_this.brMaleNameList.length;j++){if(i.first_name==vue_this.brMaleNameList[j]){i.gender='male';break;}else if(i.first_name==vue_this.brFemaleNameList[j]){i.gender='female';break;}}}
if(i.gender){if(vue_this.special_info.gender=='same'){if(i.gender===userInfo.gender){i.score=i.score+2;}}else if(vue_this.special_info.gender=='opposite'){if(i.gender!=userInfo.gender){i.score=i.score+2;}}else if(vue_this.special_info.gender=='male'){if(i.gender=='male'){i.score=i.score+2;}}else if(vue_this.special_info.gender=='female'){if(i.gender=='female'){i.score=i.score+2;}}}
if(!userInfo.birthday||(vue_this.special_info.ft_all<0&&vue_this.special_info.ft_aul<0)){i.score=i.score+1;}else if(i.birthday&&(!vue_this.special_info.ft_aul||(Number(userInfo.birthday.split('/')[2])-Number(vue_this.special_info.ft_aul)<Number(i.birthday.split('/')[2])))){if(!vue_this.special_info.ft_all||(Number(userInfo.birthday.split('/')[2])+Number(vue_this.special_info.ft_all)>Number(i.birthday.split('/')[2]))){i.score=i.score+1;}}
if(vue_this.special_info.last_name=='in'){if(userInfo.last_name==vue_this.special_info.last_name){i.score=i.score+1;}}else if(vue_this.special_info.last_name=='ex'){if(userInfo.last_name!=vue_this.special_info.last_name){i.score=i.score+1;}}else{i.score=i.score+1;}
i.score=4;if(i.score==targetScore){score_sns_friends.push(i)}}
return{friendsData:friendsData,score_sns_friends:score_sns_friends};},filterFriends:function(friendsData,familyData){var vue_this=this
if(familyData.length&&vue_this.special_info.family=='ex'){friendsData=friendsData.filter(function(value,index){for(var x=0;x<familyData.length;x++){var i=familyData[x]
if(i.id==value.id){return false;}}
return true;})}
var choice_sns_friends=[]
var local=localStorage
var userInfo=eval('('+local.userInfo+')')
var targetScore=4
var friendsScore=vue_this.calculateFriendsScore(friendsData)
choice_sns_friends=friendsScore.score_sns_friends
friendsData=friendsScore.friendsData
if(0&&choice_sns_friends.length>=vue_this.special_info.fcnt){var randomList=getRangeRandomNum(choice_sns_friends.length,vue_this.special_info.fcnt)
var length=choice_sns_friends.length;var endData=[];for(var i=0;i<length;i++){if(randomList.indexOf(i)!=-1){endData.push(choice_sns_friends[i])}}
vue_this.choice_sns_friends=endData;if(vue_this.notFriendsResultOrCanCalculateFriendResult==false){vue_this.notFriendsResultOrCanCalculateFriendResult=true;}else{vue_this.getChoiceFriends();}}
else if(1||choice_sns_friends.length<vue_this.special_info.fcnt){var photosFriendsIdList=[];FB.api('/me/photos?locale=en_US&access_token='+localStorage.accessToken,'get',{fields:['id','from','picture','images']},function(response){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
console.log('/me/photos',response)
var data=response.data||[];for(var x=0;x<data.length;x++){var i=data[x]
for(var y=0;y<friendsData.length;y++){var j=friendsData[y]
if(i.from.id==j.id||(localStorage.userId&&i.from.id==localStorage.userId)){i.from.id=null
break}}
if(i.from.id){photosFriendsIdList.push(i.from.id)}}
FB.api('/me/posts?locale=en_US&access_token='+localStorage.accessToken,'get',{fields:['comments{message,from,user_likes}','likes','with_tags','to','privacy'],limit:300},function(response){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
var data=response.data||[]
for(var ix=0;ix<data.length;ix++){if(data[ix].likes&&data[ix].likes.data.length){for(var j=0;j<data[ix].likes.data.length;j++){if(photosFriendsIdList.indexOf(data[ix].likes.data[j].id)!=-1){data[ix].likes.data[j].id=''
continue}
for(var z=0;z<friendsData.length;z++){if(friendsData[z].id==data[ix].likes.data[j].id||data[ix].likes.data[j].id==localStorage.userId){data[ix].likes.data[j].id=''
break}}
if(data[ix].likes.data[j]&&data[ix].likes.data[j].id!=''){photosFriendsIdList.push(data[ix].likes.data[j].id)}}}}
console.log('/me/posts',photosFriendsIdList)
if(photosFriendsIdList.length){var total=0
var photosFriendsData=[]
FB.api('/?locale=en_US&access_token='+localStorage.accessToken,'get',{ids:photosFriendsIdList,fields:['id','metadata{type}'],pretty:'0',sdk:'joey',metadata:1},function(res){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
var endPhotosFriendsIdList=[]
for(var i=0;i<res.length;i++){if(res[i].metadata&&res[i].metadata.type=='user'){endPhotosFriendsIdList.push(res[i].id)}}
FB.api('/?locale=en_US&access_token='+localStorage.accessToken,'get',{ids:endPhotosFriendsIdList,fields:['id','name','first_name','last_name','gender','birthday','picture.width(480).height(480)'],pretty:'0',sdk:'joey'},function(res){if(response.error&&response.error.code==2500){vue_this.jump2InfoPage()}
console.log(res)
for(var i=0;i<res.length;i++){photosFriendsData.push(res[i])}
console.log(photosFriendsData)
var photoFriendsScore=vue_this.calculateFriendsScore(photosFriendsData);choice_sns_friends=choice_sns_friends.concat(photoFriendsScore.score_sns_friends);friendsData=friendsData.concat(photoFriendsScore.friendsData);var endData=[];if(choice_sns_friends.length>vue_this.special_info.fcnt){var random=getRangeRandomNum(choice_sns_friends.length,vue_this.special_info.fcnt)
var length=choice_sns_friends.length;endData=[]
for(var i=0;i<length;i++){if(random.indexOf(i)!=-1){endData.push(choice_sns_friends[i])}}}else if(choice_sns_friends.length<vue_this.special_info.fcnt){while(targetScore!=0){targetScore=--targetScore;for(var x=0;x<friendsData.length;x++){var j=friendsData[x]
if(j.score==targetScore){choice_sns_friends.push(j)}}
console.log(choice_sns_friends)
if(choice_sns_friends.length>=vue_this.special_info.fcnt){targetScore=0;break;}}
var random=getRangeRandomNum(choice_sns_friends.length,vue_this.special_info.fcnt)
console.log(random,choice_sns_friends)
var length=choice_sns_friends.length;endData=[]
for(var i=0;i<length;i++){if(random.indexOf(i)!=-1){endData.push(choice_sns_friends[i])}}}
console.log('end endData',endData);vue_this.choice_sns_friends=endData;if(vue_this.notFriendsResultOrCanCalculateFriendResult==false){vue_this.notFriendsResultOrCanCalculateFriendResult=true;}else{vue_this.getChoiceFriends();}})})}else{console.log('end choice_sns_friends',choice_sns_friends);while(targetScore!=0){targetScore=--targetScore;for(var x=0;x<friendsData.length;x++){var j=friendsData[x]
if(j.score==targetScore){choice_sns_friends.push(j)}}
console.log(choice_sns_friends,vue_this.special_info.fcnt)
if(choice_sns_friends.length>=vue_this.special_info.fcnt){targetScore=0;break;}}
var random=getRangeRandomNum(choice_sns_friends.length,vue_this.special_info.fcnt)
var length=choice_sns_friends.length;var endData=[];for(var i=0;i<length;i++){if(random.indexOf(i)!=-1){endData.push(choice_sns_friends[i])}}
console.log('endData',endData)
vue_this.choice_sns_friends=endData;if(vue_this.notFriendsResultOrCanCalculateFriendResult==false){vue_this.notFriendsResultOrCanCalculateFriendResult=true;}else{vue_this.getChoiceFriends();}}})})}
else{console.log('end choice_sns_friends',choice_sns_friends);vue_this.choice_sns_friends=choice_sns_friends;if(vue_this.notFriendsResultOrCanCalculateFriendResult==false){vue_this.notFriendsResultOrCanCalculateFriendResult=true;}else{vue_this.getChoiceFriends();}}},getChoiceFriends:function(){var vue_this=this;var outFriends={};var index=1;var local=localStorage;var userInfo=eval('('+local.userInfo+')')
for(var x=0;x<vue_this.choice_sns_friends.length;x++){var i=vue_this.choice_sns_friends[x]
outFriends['snsfriend_'+index]={birthday:i.birthday||'',fb_id:i.id||'',first_name:i.first_name||'',full_name:i.name||'',gender:i.gender||'',id:i.id||'',last_name:i.last_name||'',name:i.name||'',profile_image_url:'https://graph.facebook.com/'+i.id+'/picture?type=large'}
index++;}
var femaleStarInfo=[{birthday:'12/11/1982',fb_id:'1',first_name:'Anne',full_name:'AnneHathaway',gender:'female',id:'1',last_name:'Hathaway',name:'AnneHathaway',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/AnneHathaway.jpeg'},{birthday:'12/13/1989',fb_id:'2',first_name:'Taylor',full_name:'TaylorSwift',gender:'female',id:'2',last_name:'Swift',name:'TaylorSwift',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/TaylorSwift.jpeg'},{birthday:'4/14/1990',fb_id:'3',first_name:'Emma',full_name:'EmmaWatson',gender:'female',id:'3',last_name:'Watson',name:'EmmaWatson',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/EmmaWatson.jpeg'},{birthday:'11/22/1984',fb_id:'4',first_name:'Scarlett',full_name:'ScarlettJohansson',gender:'female',id:'4',last_name:'Johansson',name:'ScarlettJohansson',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/ScarlettJohansson.jpeg'}];var maleStarInfo=[{birthday:'7/26/1967',fb_id:'5',first_name:'Jason',full_name:'JasonStatham',gender:'male',id:'5',last_name:'Statham',name:'JasonStatham',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/JasonStatham.jpeg'},{birthday:'7/3/1976',fb_id:'6',first_name:'Tom',full_name:'TomCruise',gender:'male',id:'6',last_name:'Cruise',name:'TomCruise',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/TomCruise.jpeg'},{birthday:'12/18/1963',fb_id:'7',first_name:'Brad',full_name:'BradPitt',gender:'male',id:'7',last_name:'Pitt',name:'BradPitt',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/BradPitt.jpeg'},{birthday:'7/30/1947',fb_id:'8',first_name:'Arnold',full_name:'Arnold Schwarzenegger',gender:'male',id:'8',last_name:'Schwarzenegger',name:'Arnold Schwarzenegger',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/Arnold Schwarzenegger.jpeg'},{birthday:'11/11/1974',fb_id:'9',first_name:'Leonardo',full_name:'LeonardoDiCaprio',gender:'male',id:'9',last_name:'DiCaprio',name:'LeonardoDiCaprio',profile_image_url:'https://s3-ap-northeast-1.amazonaws.com/vonvon-cn-static/images/cn/LeonardoDiCaprio.jpeg'}]
if(index<=vue_this.special_info.fcnt){var num=vue_this.special_info.fcnt-index+1
var indexList=getRangeRandomNum(4,num)
if((vue_this.special_info.gender=='same'&&userInfo.gender=='female')||(vue_this.special_info.gender=='opposite'&&userInfo.gender=='male')||vue_this.special_info.gender=='female'){for(var x=0;x<indexList.length;x++){var i=indexList[x]
outFriends['snsfriend_'+index]=femaleStarInfo[i]
index++}}else if((vue_this.special_info.gender=='opposite'&&userInfo.gender=='female')||(vue_this.special_info.gender=='same'&&userInfo.gender=='male')||vue_this.special_info.gender=='male'){for(var x=0;x<indexList.length;x++){var i=indexList[x]
outFriends['snsfriend_'+index]=maleStarInfo[i]
index++}}else{var indexList=getRangeRandomNum(4,num)
if(Math.random()<0.5){for(var x=0;x<indexList.length;x++){var i=indexList[x]
outFriends['snsfriend_'+index]=femaleStarInfo[i]
index++}}else{for(var x=0;x<indexList.length;x++){var i=indexList[x]
outFriends['snsfriend_'+index]=maleStarInfo[i]
index++}}}}
for(var x=0;x<vue_this.qlist.length;x++){var i=vue_this.qlist[x]
if(i.type==5){vue_this.user_choice_list[i.id]='dummy';vue_this.user_choice_list['user_profile']={birthday:userInfo.birthday||'',fb_id:userInfo.id||'',first_name:userInfo.first_name||'',full_name:userInfo.name||'',gender:userInfo.gender?userInfo.gender.substring(0,1).toUpperCase():'',id:userInfo.id||'',last_name:userInfo.last_name||'',name:userInfo.first_name||'',profile_image_url:"https://graph.facebook.com/"+userInfo.id+"/picture?type=large"};vue_this.user_choice_list['choice_sns_friends']=outFriends;}}
console.log(vue_this.user_choice_list)
vue_this.calculate();},jump2InfoPage:function(){window.location.href=window.location.protocol+'//'+window.location.host+window.location.pathname+'/i'}},mounted:function(){set_utm_cookie();var vue_this=this
var local=localStorage
var userInfo=eval('('+local.userInfo+')')
vue_this.first_name=(userInfo&&userInfo.first_name)?userInfo.first_name:''
vue_this.quiz_id=document.querySelector('#quiz_id').value
vue_this.fr_token=document.querySelector("#fr_token").value
vue_this.switch_ad_time=document.querySelector('#switch_ad_time').value
var qrcode_img=document.getElementById('qrcode_img')
vue_this.last_refresh_timestamps=Date.now()
var preview_uri=getCookie('user_upload_image_url')
if(preview_uri&&preview_uri!='undefined'){vue_this.image_url=preview_uri;vue_this.show_upload_next_button=true;}
vue_this.load_suggestion_list();vue_this.init_share();incr_inflow_stat(vue_this.quiz_id,0,get_sns_type(),'');vue_this.brFemaleNameList=['Gabriela','Ana','Amanda','Fernanda','Júlia','Beatriz','Mariana','Larissa,camila,leticia,Juliana,Natália,Thais,vitoria,laura,jéssica,Rafaela,Luana,Bruna,barbara,Maria,Isabela,Anna,Carolina,Brenda,Lívia,Aline,MIlena,giovanna,Ana Clara,Victória,Maria Clara,daniela,gabrielle','Raquel','Marcela','Andressa','luiza','Aléxia','Caroline','Stephanie','Helena','sabrina','Maria Eduarda','Raissa','Nathalia','Nayara','Carla','mary','lara','Cristina','Sarah','Michele','Ana luiza','Isadora','Yasmin','Flávia','taynara','clara','Laís','viviane','Isabella','Emanuelle','milene','Lorena','Heloisa','Clarice','diane','Patrícia','Monique','Mayara','bianca','Sofia','Gabi','camilla','Carol','jeniffer','izabella','paola','Luisa','Tainara','Gabriella','marcella','andreia','Débora','Emily','Renata','yumi','Verônica','pamela','Maria Luiza','francine','samara','Ana carolina','babi','raiane','Karen','Ester','Marcia','Giovana']
vue_this.brMaleNameList=['Gabriel','Lucas','Matheus','Pedro','leonardo','felipe','João','Vinicius','Guilherme','Daniel','LUIZ','Bruno','Rafael','arthur','Gustavo','paulo','mateus','thiago','Igor','Douglas','Victor','Joao Pedro','Vitor','Anderson','Eduardo','Caio','Rodrigo','marcos','leandro','Diego','José','Fernando','Fábio','joao vitor','henrique','willian','Carlos','marcelo','Alexandre','alex','italo','raphael','FLÁVIO','bernardo','Andre','luciano','ricardo','luis','vagner','Ramon','Adriano','Marcio','jeferson','David','geovanne','wesley','Murilo','danilo','Renan','augusto','maicon','sidney','pablo','breno','erick','luan','Emerson','luiz henrique','josue','kelvin','Aline','jean','samuel','Hugo','Davi','cristian','Renato','Jefferson','artur','geovane','raul','Sávio','Diogo','João Eduardo','Fabricio','juliano','robert','Alef','jonathan','Luca','patrick','junior','Fred','jose matheus','Tiago','Giliard','caue','vito','kaue','zaqueu']}});});}(document,Vue));;var share_sns_templates={qzone:'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={{URL}}&title={{TITLE}}&desc={{DESCRIPTION}}&summary={{SUMMARY}}&site={{SOURCE}}&pics={{IMAGE}}',qq:'http://connect.qq.com/widget/shareqq/index.html?url={{URL}}&title={{TITLE}}&source={{SOURCE}}&desc={{DESCRIPTION}}&pics={{IMAGE}}',weibo:'http://service.weibo.com/share/share.php?url={{URL}}&title={{TITLE}}%20%23vonvon%23%20%0A%0A{{DESCRIPTION}}&pic={{IMAGE}}&appkey={{WEIBOKEY}}'};function init_sns_share(link,quiz,sns_name,sns_share_callback){var data={url:location.href,origin:location.origin,source:getMetaContentByName('site')||getMetaContentByName('Site')||document.title,title:quiz["share_title"],description:'',image:quiz["share_image_url"],weiboKey:''};if(document.getElementsByClassName('sns-share-img')[0]){data['image']=document.getElementsByClassName('sns-share-img')[0].src;}
if(link){link.addEventListener('click',function(){sns_share_callback(sns_name,makeUrl(sns_name,data));});}}
function makeUrl(name,data){data['summary']=data['description'];return share_sns_templates[name].replace(/\{\{(\w)(\w*)\}\}/g,function(m,fix,key){var nameKey=name+fix+key.toLowerCase();key=(fix+key).toLowerCase();return encodeURIComponent((data[nameKey]===undefined?data[key]:data[nameKey])||'');});}
function getMetaContentByName(name){return(document.getElementsByName(name)[0]||0).content;}
function mixin(){var args=arguments;var target={};each(args,function(it){each(it,function(v,k){target[k]=v;});});return args[0]=target;}
function dataset(elem){if(elem.dataset){return elem.dataset;}
var target={};if(elem.hasAttributes()){each(elem.attributes,function(attr){var name=attr.name;if(name.indexOf('data-')!==0){return true;}
name=name.replace(/^data-/i,'').replace(/-(\w)/g,function(all,letter){return letter.toUpperCase();});target[name]=attr.value;});return target;}
return{};}
function each(obj,callback){var length=obj.length;if(length===undefined){for(var name in obj){if(obj.hasOwnProperty(name)){if(callback.call(obj[name],obj[name],name)===false){break;}}}}else{for(var i=0;i<length;i++){if(callback.call(obj[i],obj[i],i)===false){break;}}}}
function init_wx_share(quiz,wechat_share_callback){var quiz_id=quiz["id"];var disable_wechat_moment_share=quiz["disable_wechat_moment_share"];var disable_wechat_message_share=quiz["disable_wechat_message_share"];var share_title=quiz["share_title"];var share_description=quiz["share_description"];var share_image_url=quiz["share_image_url"];var share_mp_url=quiz["share_mp_url"];share_image_url=document.getElementsByClassName('wechat-share-img')[0].src;var wx_config=function(data){if(!data['config']){return;}
wx.config(data["config"]);wx.ready(function(){console.log('jssdk ok!');disable_menulist=[];if(disable_wechat_moment_share){disable_menulist.push('menuItem:share:timeline');}
if(disable_wechat_message_share){disable_menulist.push('menuItem:share:appMessage');}
if(disable_menulist.length>0){wx.hideMenuItems({menuList:disable_menulist});}
if(share_mp_url){wx.onMenuShareTimeline({title:share_title,link:share_mp_url,imgUrl:share_image_url,success:function(){wechat_share_callback();console.log('share success');},cancel:function(){console.log('share canceled');}});wx.onMenuShareAppMessage({title:share_title,link:share_mp_url,imgUrl:share_image_url,success:function(){wechat_share_callback();console.log('share success');},cancel:function(){console.log('share canceled');}});}else{Vue.http.get("http://chengbad.cn/protector/share-domain/e3/"+quiz_id).then(function(response){var share_path="";var protector_data=response.body;if(protector_data.landing_mark==="landing"){share_path=protector_data.domain+"/protector/page/"+protector_data.protector+"?system=e3"+"&product_id="+quiz_id+"&param="+encodeURI(window.location.pathname.replace('/f/','/fs/').replace('/r/','/ru/'));}else{share_path=protector_data.domain;}
wx.onMenuShareTimeline({title:share_title,link:share_path,imgUrl:share_image_url,success:function(){wechat_share_callback();console.log('share success');},cancel:function(){console.log('share canceled');}});wx.onMenuShareAppMessage({title:share_title,link:share_path,desc:share_description,imgUrl:share_image_url,success:function(){wechat_share_callback();console.log('share success');},cancel:function(){console.log('share canceled');}});});}});wx.error(function(res){console.log('jssdk error!'+res)});};var xhr=new XMLHttpRequest();xhr.open('POST','/wx_config',true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');xhr.onload=function(){if(xhr.status===200){wx_config(JSON.parse(xhr.responseText));}else{console.log('mns stat send failed');}};var data={'csrfmiddlewaretoken':getCookie('csrftoken'),'url':window.location.href};var fd=Object.keys(data).map(function(k){return encodeURIComponent(k)+'='+encodeURIComponent(data[k]);}).join('&');xhr.send(fd);};function incr_inflow_stat(quiz_id,meaning_id,sns,src_type,callback){var inflow_quiz_ids=JSON.parse(localStorage.getItem('inflow_quiz_id_list'));if(!inflow_quiz_ids||!Array.isArray(inflow_quiz_ids)){inflow_quiz_ids=[];}
if(inflow_quiz_ids.indexOf(quiz_id)==-1){inflow_quiz_ids.push(quiz_id);localStorage.setItem('inflow_quiz_id_list',JSON.stringify(inflow_quiz_ids));send_native_msg(quiz_id,'inflow|inflow_each',callback,JSON.stringify({event_type:'inflow',event_items:{"quiz_id":quiz_id,"meaning_id":meaning_id,"is_unique":true,"sns":sns,"src_type":src_type}}));}else{send_native_msg(quiz_id,'inflow_each',callback,JSON.stringify({event_type:'inflow',event_items:{"quiz_id":quiz_id,"meaning_id":meaning_id,"is_unique":false,"sns":sns,"src_type":src_type}}));}}
function incr_taker_stat(quiz_id,meaning_id,login_sns,inflow_sns,inflow_type,callback){var taker_quiz_ids=JSON.parse(localStorage.getItem('taker_quiz_id_list'));if(!taker_quiz_ids||!Array.isArray(taker_quiz_ids)){taker_quiz_ids=[];}
if(taker_quiz_ids.indexOf(quiz_id)==-1){taker_quiz_ids.push(quiz_id);localStorage.setItem('taker_quiz_id_list',JSON.stringify(taker_quiz_ids));send_native_msg(quiz_id,'taker|taker_each',callback,JSON.stringify({event_type:'result',event_items:{"quiz_id":quiz_id,"meaning_id":meaning_id,"is_unique":true,"login_sns":login_sns,"inflow_sns":inflow_sns,"inflow_type":inflow_type}}));}else{send_native_msg(quiz_id,'taker_each',callback,JSON.stringify({event_type:'result',event_items:{"quiz_id":quiz_id,"meaning_id":meaning_id,"is_unique":false,"login_sns":login_sns,"inflow_sns":inflow_sns,"inflow_type":inflow_type}}));}}
function incr_qrsave_stat(quiz_id,meaning_id,sns,inflow_type,callback){send_native_msg(quiz_id,'qrsave',callback,JSON.stringify({event_type:'share',event_items:{"quiz_id":quiz_id,"meaning_id":meaning_id,"sns":sns,"inflow_type":inflow_type}}));}
function incr_share_stat(quiz_id,meaning_id,sns,inflow_type,callback){send_native_msg(quiz_id,'share',callback,JSON.stringify({event_type:'share',event_items:{"quiz_id":quiz_id,"meaning_id":meaning_id,"sns":sns,"inflow_type":inflow_type}}));}
function incr_question_share_stat(quiz_id,meaning_id,sns,inflow_type,question_id,callback){send_native_msg(quiz_id,'share',callback,JSON.stringify({event_type:'question_share',event_items:{"quiz_id":quiz_id,"meaning_id":meaning_id,"sns":sns,"inflow_type":inflow_type}}));}
function send_native_msg(quiz_id,stat_type,callback,mns_info){var xhr=new XMLHttpRequest();xhr.open('POST','/stat/incr',true);xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded; charset=UTF-8');xhr.onload=function(){if(xhr.status===200){console.log('native stat '+stat_type+' send');if(callback){callback();}}else{console.log('native stat '+stat_type+' send failed');}};var data={'csrfmiddlewaretoken':getCookie('csrftoken')};if(stat_type){data['stat_type']=stat_type;data['quiz_id']=quiz_id;}
if(mns_info){data['mns_info']=mns_info;}
var fd=Object.keys(data).map(function(k){return encodeURIComponent(k)+'='+encodeURIComponent(data[k])}).join('&');xhr.send(fd);};function drawPhotoImage(image,canvas,face_image,orientation){var max_size=544,width=face_image.width,height=face_image.height;if(width>height){if(width>max_size){height*=max_size/width;width=max_size;}}else{if(height>max_size){width*=max_size/height;height=max_size;}}
canvas.width=width;canvas.height=height;if(navigator.userAgent.match(/iphone/i)||navigator.userAgent.match(/Macintosh/i)){if(orientation!=""&&orientation!=1){switch(orientation){case 6:rotateImg(image,'left',canvas,width,height);break;case 8:rotateImg(image,'right',canvas,width,height);break;case 3:rotateImg(image,'right2',canvas,width,height);break;default:canvas.getContext('2d').drawImage(face_image,0,0,width,height);break;}}else{canvas.getContext('2d').drawImage(face_image,0,0,width,height);}}else if(judge_sm_phone()){rotateImg(image,'left',canvas,width,height);}else{canvas.getContext('2d').drawImage(face_image,0,0,width,height);}}
function canvasToOss(conn_info,canvas,key,oss_url,callback){var OSS_URL='http://face-detect.oss-cn-hangzhou.aliyuncs.com';var dataUrl=canvas.toDataURL('image/png');var resizedImage=dataURLToBlob(dataUrl);var fd=new FormData();fd.append('key',key);fd.append('Content-Type',resizedImage.type);fd.append('OSSAccessKeyId',conn_info.key);fd.append('policy',conn_info.policy);fd.append('Signature',conn_info.signature);fd.append("file",resizedImage);var xhr=new XMLHttpRequest();xhr.open('POST',OSS_URL,true);xhr.addEventListener("load",callback,false);xhr.send(fd);}
function rotateImg(img,direction,canvas,width,height){var min_step=0;var max_step=3;if(img==null){return;}
var step=2;if(step==null){step=min_step;}
if(direction=='right'){step++;step>max_step&&(step=min_step);}else if(direction=='right2'){step=2;}else{step--;step<min_step&&(step=max_step);}
var degree=step*90*Math.PI/180;var ctx=canvas.getContext('2d');switch(step){case 0:canvas.width=width;canvas.height=height;ctx.drawImage(img,0,0,width,height);break;case 1:canvas.width=height;canvas.height=width;ctx.rotate(degree);ctx.drawImage(img,0,-height,width,height);break;case 2:canvas.width=width;canvas.height=height;ctx.rotate(degree);ctx.drawImage(img,-width,-height,width,height);break;case 3:canvas.width=height;canvas.height=width;ctx.rotate(degree);ctx.drawImage(img,-width,0,width,height);break;}}
var dataURLToBlob=function(dataURL){var BASE64_MARKER=';base64,';if(dataURL.indexOf(BASE64_MARKER)==-1){var parts=dataURL.split(',');var contentType=parts[0].split(':')[1];var raw=parts[1];return new Blob([raw],{type:contentType});}
var parts=dataURL.split(BASE64_MARKER);var contentType=parts[0].split(':')[1];var raw=window.atob(parts[1]);var rawLength=raw.length;var uInt8Array=new Uint8Array(rawLength);for(var i=0;i<rawLength;++i){uInt8Array[i]=raw.charCodeAt(i);}
return new Blob([uInt8Array],{type:contentType});};;(function(){var debug=false;var root=this;var EXIF=function(obj){if(obj instanceof EXIF)return obj;if(!(this instanceof EXIF))return new EXIF(obj);this.EXIFwrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=EXIF;}
exports.EXIF=EXIF;}else{root.EXIF=EXIF;}
var ExifTags=EXIF.Tags={0x9000:"ExifVersion",0xA000:"FlashpixVersion",0xA001:"ColorSpace",0xA002:"PixelXDimension",0xA003:"PixelYDimension",0x9101:"ComponentsConfiguration",0x9102:"CompressedBitsPerPixel",0x927C:"MakerNote",0x9286:"UserComment",0xA004:"RelatedSoundFile",0x9003:"DateTimeOriginal",0x9004:"DateTimeDigitized",0x9290:"SubsecTime",0x9291:"SubsecTimeOriginal",0x9292:"SubsecTimeDigitized",0x829A:"ExposureTime",0x829D:"FNumber",0x8822:"ExposureProgram",0x8824:"SpectralSensitivity",0x8827:"ISOSpeedRatings",0x8828:"OECF",0x9201:"ShutterSpeedValue",0x9202:"ApertureValue",0x9203:"BrightnessValue",0x9204:"ExposureBias",0x9205:"MaxApertureValue",0x9206:"SubjectDistance",0x9207:"MeteringMode",0x9208:"LightSource",0x9209:"Flash",0x9214:"SubjectArea",0x920A:"FocalLength",0xA20B:"FlashEnergy",0xA20C:"SpatialFrequencyResponse",0xA20E:"FocalPlaneXResolution",0xA20F:"FocalPlaneYResolution",0xA210:"FocalPlaneResolutionUnit",0xA214:"SubjectLocation",0xA215:"ExposureIndex",0xA217:"SensingMethod",0xA300:"FileSource",0xA301:"SceneType",0xA302:"CFAPattern",0xA401:"CustomRendered",0xA402:"ExposureMode",0xA403:"WhiteBalance",0xA404:"DigitalZoomRation",0xA405:"FocalLengthIn35mmFilm",0xA406:"SceneCaptureType",0xA407:"GainControl",0xA408:"Contrast",0xA409:"Saturation",0xA40A:"Sharpness",0xA40B:"DeviceSettingDescription",0xA40C:"SubjectDistanceRange",0xA005:"InteroperabilityIFDPointer",0xA420:"ImageUniqueID"};var TiffTags=EXIF.TiffTags={0x0100:"ImageWidth",0x0101:"ImageHeight",0x8769:"ExifIFDPointer",0x8825:"GPSInfoIFDPointer",0xA005:"InteroperabilityIFDPointer",0x0102:"BitsPerSample",0x0103:"Compression",0x0106:"PhotometricInterpretation",0x0112:"Orientation",0x0115:"SamplesPerPixel",0x011C:"PlanarConfiguration",0x0212:"YCbCrSubSampling",0x0213:"YCbCrPositioning",0x011A:"XResolution",0x011B:"YResolution",0x0128:"ResolutionUnit",0x0111:"StripOffsets",0x0116:"RowsPerStrip",0x0117:"StripByteCounts",0x0201:"JPEGInterchangeFormat",0x0202:"JPEGInterchangeFormatLength",0x012D:"TransferFunction",0x013E:"WhitePoint",0x013F:"PrimaryChromaticities",0x0211:"YCbCrCoefficients",0x0214:"ReferenceBlackWhite",0x0132:"DateTime",0x010E:"ImageDescription",0x010F:"Make",0x0110:"Model",0x0131:"Software",0x013B:"Artist",0x8298:"Copyright"};var GPSTags=EXIF.GPSTags={0x0000:"GPSVersionID",0x0001:"GPSLatitudeRef",0x0002:"GPSLatitude",0x0003:"GPSLongitudeRef",0x0004:"GPSLongitude",0x0005:"GPSAltitudeRef",0x0006:"GPSAltitude",0x0007:"GPSTimeStamp",0x0008:"GPSSatellites",0x0009:"GPSStatus",0x000A:"GPSMeasureMode",0x000B:"GPSDOP",0x000C:"GPSSpeedRef",0x000D:"GPSSpeed",0x000E:"GPSTrackRef",0x000F:"GPSTrack",0x0010:"GPSImgDirectionRef",0x0011:"GPSImgDirection",0x0012:"GPSMapDatum",0x0013:"GPSDestLatitudeRef",0x0014:"GPSDestLatitude",0x0015:"GPSDestLongitudeRef",0x0016:"GPSDestLongitude",0x0017:"GPSDestBearingRef",0x0018:"GPSDestBearing",0x0019:"GPSDestDistanceRef",0x001A:"GPSDestDistance",0x001B:"GPSProcessingMethod",0x001C:"GPSAreaInformation",0x001D:"GPSDateStamp",0x001E:"GPSDifferential"};var StringValues=EXIF.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0x0000:"Flash did not fire",0x0001:"Flash fired",0x0005:"Strobe return light not detected",0x0007:"Strobe return light detected",0x0009:"Flash fired, compulsory flash mode",0x000D:"Flash fired, compulsory flash mode, return light not detected",0x000F:"Flash fired, compulsory flash mode, return light detected",0x0010:"Flash did not fire, compulsory flash mode",0x0018:"Flash did not fire, auto mode",0x0019:"Flash fired, auto mode",0x001D:"Flash fired, auto mode, return light not detected",0x001F:"Flash fired, auto mode, return light detected",0x0020:"No flash function",0x0041:"Flash fired, red-eye reduction mode",0x0045:"Flash fired, red-eye reduction mode, return light not detected",0x0047:"Flash fired, red-eye reduction mode, return light detected",0x0049:"Flash fired, compulsory flash mode, red-eye reduction mode",0x004D:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",0x004F:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",0x0059:"Flash fired, auto mode, red-eye reduction mode",0x005D:"Flash fired, auto mode, return light not detected, red-eye reduction mode",0x005F:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function addEvent(element,event,handler){if(element.addEventListener){element.addEventListener(event,handler,false);}else if(element.attachEvent){element.attachEvent("on"+event,handler);}}
function imageHasData(img){return!!(img.exifdata);}
function base64ToArrayBuffer(base64,contentType){contentType=contentType||base64.match(/^data\:([^\;]+)\;base64,/mi)[1]||'';base64=base64.replace(/^data\:([^\;]+)\;base64,/gmi,'');var binary=atob(base64);var len=binary.length;var buffer=new ArrayBuffer(len);var view=new Uint8Array(buffer);for(var i=0;i<len;i++){view[i]=binary.charCodeAt(i);}
return buffer;}
function objectURLToBlob(url,callback){var http=new XMLHttpRequest();http.open("GET",url,true);http.responseType="blob";http.onload=function(e){if(this.status==200||this.status===0){callback(this.response);}};http.send();}
function getImageData(img,callback){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile);var iptcdata=findIPTCinJPEG(binFile);img.exifdata=data||{};img.iptcdata=iptcdata||{};if(callback){callback.call(img);}}
if(img.src){if(/^data\:/i.test(img.src)){var arrayBuffer=base64ToArrayBuffer(img.src);handleBinaryFile(arrayBuffer);}else if(/^blob\:/i.test(img.src)){var fileReader=new FileReader();fileReader.onload=function(e){handleBinaryFile(e.target.result);};objectURLToBlob(img.src,function(blob){fileReader.readAsArrayBuffer(blob);});}else{var http=new XMLHttpRequest();http.onload=function(){if(this.status==200||this.status===0){handleBinaryFile(http.response);}else{throw"Could not load image";}
http=null;};http.open("GET",img.src,true);http.responseType="arraybuffer";http.send(null);}}else if(window.FileReader&&(img instanceof window.Blob||img instanceof window.File)){var fileReader=new FileReader();fileReader.onload=function(e){if(debug)console.log("Got file of length "+e.target.result.byteLength);handleBinaryFile(e.target.result);};fileReader.readAsArrayBuffer(img);}}
function findEXIFinJPEG(file){var dataView=new DataView(file);if(debug)console.log("Got file of length "+file.byteLength);if((dataView.getUint8(0)!=0xFF)||(dataView.getUint8(1)!=0xD8)){if(debug)console.log("Not a valid JPEG");return false;}
var offset=2,length=file.byteLength,marker;while(offset<length){if(dataView.getUint8(offset)!=0xFF){if(debug)console.log("Not a valid marker at offset "+offset+", found: "+dataView.getUint8(offset));return false;}
marker=dataView.getUint8(offset+1);if(debug)console.log(marker);if(marker==225){if(debug)console.log("Found 0xFFE1 marker");return readEXIFData(dataView,offset+4,dataView.getUint16(offset+2)-2);}else{offset+=2+dataView.getUint16(offset+2);}}}
function findIPTCinJPEG(file){var dataView=new DataView(file);if(debug)console.log("Got file of length "+file.byteLength);if((dataView.getUint8(0)!=0xFF)||(dataView.getUint8(1)!=0xD8)){if(debug)console.log("Not a valid JPEG");return false;}
var offset=2,length=file.byteLength;var isFieldSegmentStart=function(dataView,offset){return(dataView.getUint8(offset)===0x38&&dataView.getUint8(offset+1)===0x42&&dataView.getUint8(offset+2)===0x49&&dataView.getUint8(offset+3)===0x4D&&dataView.getUint8(offset+4)===0x04&&dataView.getUint8(offset+5)===0x04);};while(offset<length){if(isFieldSegmentStart(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);if(nameHeaderLength%2!==0)nameHeaderLength+=1;if(nameHeaderLength===0){nameHeaderLength=4;}
var startOffset=offset+8+nameHeaderLength;var sectionLength=dataView.getUint16(offset+6+nameHeaderLength);return readIPTCData(file,startOffset,sectionLength);break;}
offset++;}}
var IptcFieldMap={0x78:'caption',0x6E:'credit',0x19:'keywords',0x37:'dateCreated',0x50:'byline',0x55:'bylineTitle',0x7A:'captionWriter',0x69:'headline',0x74:'copyright',0x0F:'category'};function readIPTCData(file,startOffset,sectionLength){var dataView=new DataView(file);var data={};var fieldValue,fieldName,dataSize,segmentType,segmentSize;var segmentStartPos=startOffset;while(segmentStartPos<startOffset+sectionLength){if(dataView.getUint8(segmentStartPos)===0x1C&&dataView.getUint8(segmentStartPos+1)===0x02){segmentType=dataView.getUint8(segmentStartPos+2);if(segmentType in IptcFieldMap){dataSize=dataView.getInt16(segmentStartPos+3);segmentSize=dataSize+5;fieldName=IptcFieldMap[segmentType];fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize);if(data.hasOwnProperty(fieldName)){if(data[fieldName]instanceof Array){data[fieldName].push(fieldValue);}
else{data[fieldName]=[data[fieldName],fieldValue];}}
else{data[fieldName]=fieldValue;}}}
segmentStartPos++;}
return data;}
function readTags(file,tiffStart,dirStart,strings,bigEnd){var entries=file.getUint16(dirStart,!bigEnd),tags={},entryOffset,tag,i;for(i=0;i<entries;i++){entryOffset=dirStart+i*12+2;tag=strings[file.getUint16(entryOffset,!bigEnd)];if(!tag&&debug)console.log("Unknown tag: "+file.getUint16(entryOffset,!bigEnd));tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd);}
return tags;}
function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart,offset,vals,val,n,numerator,denominator;switch(type){case 1:case 7:if(numValues==1){return file.getUint8(entryOffset+8,!bigEnd);}else{offset=numValues>4?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint8(offset+n);}
return vals;}
case 2:offset=numValues>4?valueOffset:(entryOffset+8);return getStringFromDB(file,offset,numValues-1);case 3:if(numValues==1){return file.getUint16(entryOffset+8,!bigEnd);}else{offset=numValues>2?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint16(offset+2*n,!bigEnd);}
return vals;}
case 4:if(numValues==1){return file.getUint32(entryOffset+8,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);}
return vals;}
case 5:if(numValues==1){numerator=file.getUint32(valueOffset,!bigEnd);denominator=file.getUint32(valueOffset+4,!bigEnd);val=new Number(numerator/denominator);val.numerator=numerator;val.denominator=denominator;return val;}else{vals=[];for(n=0;n<numValues;n++){numerator=file.getUint32(valueOffset+8*n,!bigEnd);denominator=file.getUint32(valueOffset+4+8*n,!bigEnd);vals[n]=new Number(numerator/denominator);vals[n].numerator=numerator;vals[n].denominator=denominator;}
return vals;}
case 9:if(numValues==1){return file.getInt32(entryOffset+8,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);}
return vals;}
case 10:if(numValues==1){return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);}
return vals;}}}
function getStringFromDB(buffer,start,length){var outstr="";for(n=start;n<start+length;n++){outstr+=String.fromCharCode(buffer.getUint8(n));}
return outstr;}
function readEXIFData(file,start){if(getStringFromDB(file,start,4)!="Exif"){if(debug)console.log("Not valid EXIF data! "+getStringFromDB(file,start,4));return false;}
var bigEnd,tags,tag,exifData,gpsData,tiffOffset=start+6;if(file.getUint16(tiffOffset)==0x4949){bigEnd=false;}else if(file.getUint16(tiffOffset)==0x4D4D){bigEnd=true;}else{if(debug)console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return false;}
if(file.getUint16(tiffOffset+2,!bigEnd)!=0x002A){if(debug)console.log("Not valid TIFF data! (no 0x002A)");return false;}
var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<0x00000008){if(debug)console.log("Not valid TIFF data! (First offset less than 8)",file.getUint32(tiffOffset+4,!bigEnd));return false;}
tags=readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd);if(tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+
StringValues.Components[exifData[tag][1]]+
StringValues.Components[exifData[tag][2]]+
StringValues.Components[exifData[tag][3]];break;}
tags[tag]=exifData[tag];}}
if(tags.GPSInfoIFDPointer){gpsData=readTags(file,tiffOffset,tiffOffset+tags.GPSInfoIFDPointer,GPSTags,bigEnd);for(tag in gpsData){switch(tag){case"GPSVersionID":gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3];break;}
tags[tag]=gpsData[tag];}}
return tags;}
EXIF.getData=function(img,callback){if((img instanceof Image||img instanceof HTMLImageElement)&&!img.complete)return false;if(!imageHasData(img)){getImageData(img,callback);}else{if(callback){callback.call(img);}}
return true;}
EXIF.getTag=function(img,tag){if(!imageHasData(img))return;return img.exifdata[tag];}
EXIF.getAllTags=function(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data){if(data.hasOwnProperty(a)){tags[a]=data[a];}}
return tags;}
EXIF.pretty=function(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data){if(data.hasOwnProperty(a)){if(typeof data[a]=="object"){if(data[a]instanceof Number){strPretty+=a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\r\n";}else{strPretty+=a+" : ["+data[a].length+" values]\r\n";}}else{strPretty+=a+" : "+data[a]+"\r\n";}}}
return strPretty;}
EXIF.readFromBinaryFile=function(file){return findEXIFinJPEG(file);}
if(typeof define==='function'&&define.amd){define('exif-js',[],function(){return EXIF;});}}.call(this));document.addEventListener("DOMContentLoaded",function(event){if(window.location.hostname=='wechat.battlesteed.cn'){window.location.href='http://test.t.ziont.cn/?a=e3zb1&q=19';}});